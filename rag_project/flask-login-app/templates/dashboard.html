{% extends "base.html" %}

{% block title %}Dashboard - Auth System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Welcome to your Dashboard, {{ username }}!</h4>
            </div>
            <div class="card-body">
                <p>You have successfully logged into the system.</p>
                <p>Your authentication events are being logged for security monitoring.</p>
                
                <div class="mt-4">
                    <h5>Recent Authentication Events</h5>
                    <div id="auth-events" class="mt-3">
                        <p>Loading events...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Fetch and display authentication events
    fetch('/api/auth-events')
        .then(response => response.json())
        .then(events => {
            const eventsContainer = document.getElementById('auth-events');
            if (events.length === 0) {
                eventsContainer.innerHTML = '<p>No events found.</p>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Timestamp</th><th>Event Type</th><th>Outcome</th><th>IP</th><th>Device</th></tr></thead><tbody>';
            
            events.forEach(event => {
                html += `<tr>
                    <td>${new Date(event.timestamp).toLocaleString()}</td>
                    <td>${event.event_type}</td>
                    <td><span class="badge ${event.outcome === 'success' ? 'bg-success' : 'bg-danger'}">${event.outcome}</span></td>
                    <td>${event.ip}</td>
                    <td>${event.device_info}</td>
                </tr>`;
            });
            
            html += '</tbody></table></div>';
            eventsContainer.innerHTML = html;
        })
        .catch(error => {
            console.error('Error fetching events:', error);
            document.getElementById('auth-events').innerHTML = '<p>Error loading events.</p>';
        });
</script>
{% endblock %}